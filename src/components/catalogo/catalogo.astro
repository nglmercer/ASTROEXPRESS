---
import { fetchapi } from '@utils/fetchserver.js';
import CatalogCard from '@components/card/CatalogCard.astro';
import type { Signal } from 'solid-js';
import ObjectTable from '@components/solid/ObjectTableSolid.tsx';
const { page } = Astro.params;
const post = await fetchapi.getInfoCatalogo(page);
let Item;
if (!post) {
  return
} else {
  Item = Array.isArray(post) ? post[0] : post;
  console.log("Catalogo data:", post);
}
const temporadas = await  fetchapi.getTemporadas(page);
const temporadarray = Array.isArray(temporadas) ? temporadas : [temporadas];
const keys = [
  "nombreCatalogo",
  "idTemporada",
  "numeroTemporada",
  "nombreTemporada",
  "portadaTemporada",
  "catalogoTemporada",
  "nsfw",
  "tipoCatalogo",
  "trailerCatalogo",
]
const actions = [
  { name: 'edit', icon: 'edit', label: 'Edit' },
  { name: 'delete', icon: 'delete', label: 'Delete' },
  { name: 'view', icon: 'view', label: 'View' },
];
const darkMode = true;
const onRowActivatedcb = () => {
  console.log("Row activated:");
};
const onMenucb = () => {
  console.log("Menu action:",  "on row:");
};
const onInternalActioncb = () => {
  console.log("Internal action:", "on row:");
};
---
<script src="/src/components/tablejs/modal.js"></script>
<script src="/src/components/tablejs/table.js"></script>
<script src="/src/components/catalogo/catalogo.js"></script>
<div class="MainInformation" data-page-num={page}>

  <CatalogCard
  titulo={Item.nombreCatalogo}
  descripcion={Item.descripcionCatalogo}
  categorias={Item.categorias}
  imagen={Item.imagenFondoCatalogo}
  />

</div>
<div class="container">
  <div class="button-group">
    <button data-form-type="temporada" class="primary">Temporada</button>
    <button data-form-type="user" class="primary">Usuario</button>
    <button data-form-type="catalogo" class="primary">Catalogo</button>
</div>

<dlg-cont id="modal-container">
    <dyn-obj-disp id="dynamic-editor" mode="edit" darkmode>
    </dyn-obj-disp>
</dlg-cont>

<ObjectTable
  data={temporadarray}
  keys={keys}
  actions={actions}
  darkMode={darkMode}
  onRowActivated={onRowActivatedcb}
  onMenu={onMenucb}
  onInternalAction={onInternalActioncb}
/>
<object-table-lit id="catalogo" darkmode></object-table-lit>
<script define:vars={{ Item }}>
    console.log("Catalogo data:", Item );
</script>
<script>
  import { fetchapi } from '@utils/fetchserver.js';
  document.addEventListener('DOMContentLoaded', async () => {
/*     const element = document.querySelector('[data-page-num]');
    const pageNum = Number(element?.dataset.pageNum) || 1;
    console.log("Page Number:", pageNum);
    const temporadas = await fetchapi.getTemporadas(pageNum);
    console.log("Temporadas data:", temporadas); */
  });
</script>
</div>

<style>
    button { padding: 0.6em 1.2em; cursor: pointer; margin: 5px; border-radius: 4px; border: 1px solid #555; background-color: #333; color: white; }
        button.primary { background-color: #007bff; border-color: #007bff; }
        button:hover { filter: brightness(1.2); }
        #modal-container dyn-obj-disp { /* Estilo m√°s general */
            min-width: 400px;
            display: block; /* Asegurar que toma espacio */
            background-color: #222; /* Fondo para el contenido del modal */
            border-radius: 8px;
             /* obj-edit-form dentro no necesita borde/padding extra */
        }
         #modal-container dyn-obj-disp obj-edit-frm {
             border: none;
             padding: 0;
             background: transparent;
         }
        .output { margin-top: 1rem; padding: 1rem; background-color: #1a1a1a; border: 1px solid #333; border-radius: 5px; white-space: pre-wrap; font-family: monospace; min-height: 50px;}
        .loading { font-style: italic; color: #aaa; }
</style>