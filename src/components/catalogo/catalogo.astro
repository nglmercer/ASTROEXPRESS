---
import { fetchapi } from '@utils/fetchserver.js';
import CatalogCard from '@components/card/CatalogCard.astro';
const { params } = Astro;
const idCatalogo = params.idCatalogo;
function toSingle<T>(value: T | T[], defaultValue?: T): T {
  if (value == null) {
    throw new Error("Input cannot be null or undefined");
  }
  if (Array.isArray(value)) {
    if (value.length === 0) {
      if (defaultValue === undefined) {
        throw new Error("Cannot convert empty array to single value");
      }
      return defaultValue;
    }
    return value[0];
  }
  return value;
}
function toArray<T>(value: T | T[]): T[] {
  if (value == null) {
    throw new Error("Input cannot be null or undefined");
  }
  return Array.isArray(value) ? value : [value];
}
const post = await fetchapi.getInfoCatalogo(idCatalogo);
const objpost = toSingle(post)
const temporadas = await  fetchapi.getTemporadas(idCatalogo);
const temporadarray = toArray(temporadas);

const keys = [
  "nombreTemporada",
  "idTemporada",
  "numeroTemporada",
  "portadaTemporada",
  "catalogoTemporada",
  "nsfw",
]

---
<script src="/src/components/tablejs/modal.js"></script>
<script src="/src/components/tablejs/table.js"></script>
<script src="/src/components/catalogo/catalogo.js"></script>
<div class="MainInformation" data-page-num={idCatalogo}>

  <CatalogCard
   data={objpost}
  />

</div>
<div class="container">
  <div class="button-group">
    <button data-form-type="temporada" class="primary">Temporada</button>
    <button data-form-type="user" class="primary">Usuario</button>
    <button data-form-type="catalogo" class="primary">Catalogo</button>
</div>

<dlg-cont id="modal-container">
    <dyn-obj-disp id="dynamic-editor" mode="edit" 
    darkmode>
    </dyn-obj-disp>
</dlg-cont>

<object-table-lit id="catalogo" darkmode
 ></object-table-lit>

</div>
<script define:vars={{objpost,keys,temporadarray}}>
  document.addEventListener("DOMContentLoaded",async function() {
      const element = document.getElementById("catalogo")
      const itemsisarray = Array.isArray(temporadarray) ? temporadarray : [temporadarray];
      element.data = itemsisarray;
      element.keys = keys
      console.log(element, temporadarray, keys,objpost)
  })
</script>
<style>
    button { padding: 0.6em 1.2em; cursor: pointer; margin: 5px; border-radius: 4px; border: 1px solid #555; background-color: #333; color: white; }
        button.primary { background-color: #007bff; border-color: #007bff; }
        button:hover { filter: brightness(1.2); }
        #modal-container dyn-obj-disp { /* Estilo m√°s general */
            min-width: 400px;
            display: block; /* Asegurar que toma espacio */
            background-color: #222; /* Fondo para el contenido del modal */
            border-radius: 8px;
             /* obj-edit-form dentro no necesita borde/padding extra */
        }
         #modal-container dyn-obj-disp obj-edit-frm {
             border: none;
             padding: 0;
             background: transparent;
         }
        .output { margin-top: 1rem; padding: 1rem; background-color: #1a1a1a; border: 1px solid #333; border-radius: 5px; white-space: pre-wrap; font-family: monospace; min-height: 50px;}
        .loading { font-style: italic; color: #aaa; }
</style>