---
import LoginPage from "@pages/login.astro";
const { path } =  Astro.params;
console.log(path);

---
<script src="/src/components/lit/litcomponents.js"></script>
<LoginPage />
<script define:vars={{ path }}>
  var RecoveryOBJ = { path: path }
  window.RecoveryOBJ = RecoveryOBJ;
</script>
<script>
  import MicroModal from "micromodal";
  import { loginservice } from "@utils/fetchapi";
document.addEventListener('DOMContentLoaded', async function() {
    const modal = document.querySelector('#modal-2');
    const buttonform = document.getElementById("confirmbtn")
    const verifyInput = document.querySelector("base-recovery-code-input")
    if (!modal || !buttonform) return;
    MicroModal.show('modal-2',window.Modaloptions); // Mostrar el modal
    
    console.log("modal", modal);
    console.log("buttonform",buttonform)
    const events = ["submit"];
    console.log("verifyInput",verifyInput)
    events.forEach(event => {
      verifyInput?.addEventListener(event,async function (e){
        console.log("event",e)
        console.log("verifyInput",verifyInput.value, window.RecoveryOBJ)
        const codigo = verifyInput.value, code = verifyInput.value;
        const result = await loginservice.changePassword({
          path: window.RecoveryOBJ.path,
          codigo,
          code
        })
        console.log("result",result)
      })
    })
    buttonform?.addEventListener("click",function (e){
      const value = verifyInput?.value
      verifyInput?.setState("loading")
      console.log("click",value)
    })

});
</script>
